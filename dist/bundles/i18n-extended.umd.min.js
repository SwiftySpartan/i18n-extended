!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core")):"function"==typeof define&&define.amd?define(["exports","@angular/core"],t):t(e["i18n-extended"]=e["i18n-extended"]||{},e.ng.core)}(this,function(e,t){"use strict";var n=new t.InjectionToken("I18N_EXTENDED_DATA"),r=function(){function e(e){this.i18nData=e,this.language="en",this.files?this.files=[""]:this.files=this.i18nData()}return e.prototype.getTranslationFile=function(){var t=this;return this.files.filter(function(e){return e.includes('target-language="'+t.language+'"')})[0]},e.prototype.setLanguage=function(e){this.language=e},e.prototype.translateText=function(e,t,n){var r=e;try{var i=this.getTranslationFile();if(!i)return r;var a=i.match(/<source\b[^>]*>(.*?)<[/]source>/g),o=i.match(/<target\b[^>]*>(.*?)<[/]target>/g);if(!a||!o)return e;for(var s=[],l=0;l<a.length;l++)0===l?s=[{source:a[l].replace(/<source\b[^>]*>/g,"").replace(/<[/]source>/g,""),target:o[l].replace(/<target\b[^>]*>/g,"").replace(/<[/]target>/g,"")}]:s.push({source:a[l].replace(/<source\b[^>]*>/g,"").replace(/<[/]source>/g,""),target:o[l].replace(/<target\b[^>]*>/g,"").replace(/<[/]target>/g,"")});r=this.cottonReplaceAlogithm(e,s,t)}catch(e){return r}return r},e.prototype.cottonReplaceAlogithm=function(e,t,n){var r=e;if("string"!=typeof e||!e)return r;if(!t)return r;for(var i=0,a=t;i<a.length;i++){var o=a[i],s=o.source,l=o.target;if(s&&l){if("string"==typeof s&&s===e){r=l;break}if(n&&this.isTranslation(e,s,n)){r=this.digestTranslation(e,s,l,n);break}if(this.hasInterpretation(s)&&this.isTranslation(e,s)){r=this.digestTranslation(e,s,l);break}}}return r||(r=e),r},e.prototype.isTranslation=function(e,t,n){var r=0,i=this.breakSentanceIntoChars(e),a=this.breakSentanceIntoChars(this.removeInterpolation(t));if(!a||!i)return!1;if(n){for(var o=t,s=0;s<n.length;s++)o=o.replace(/<x\b[^>]*>/,String(n[s]));if(o.trim()===e.trim())return!0}var l=t.replace(/<x\b[^>]*>/g,"");if(a.length===i.length&&l&&e.includes(l.trim()))return!0;for(var c=0;c<a.length;c++)i.includes(a[c])&&r++;var u=this.removeInterpolation(t).match(/i18nExtendedVariable/g);if(0<r&&u&&r+u.length===i.length)return!0;return!1},e.prototype.breakSentanceIntoChars=function(e){return e.match(/\w+|[^\s\w]+/g)},e.prototype.removeInterpolation=function(e){return e.replace(/<x\b[^>]*>/g,"i18nExtendedVariable")},e.prototype.fetchInterpolationNames=function(e){return e.match(/<x\b[^>]*>/g)},e.prototype.hasInterpretation=function(e){var t=e.match(/<x\b[^>]*>/g);return!!t&&0<t.length},e.prototype.digestTranslation=function(e,t,n,r){var i=this.removeInterpolation(n),a=this.breakSentanceIntoChars(e),o=this.breakSentanceIntoChars(this.removeInterpolation(t)),s=this.breakSentanceIntoChars(i);if(!o||!s||!a)return e;if(r){var l=this.fetchInterpolationNames(t),c=this.fetchInterpolationNames(n),u=[];if(c&&l)for(var p=0;p<r.length;p++)u.splice(c.indexOf(l[p]),0,String(r[p]));for(p=0;p<u.length;p++)i=i.replace("i18nExtendedVariable",String(u[p]));return i}var f=[];for(p=0;p<a.length;p++){-1===a.indexOf(o[p])&&f.push(a[p])}for(p=0;p<f.length;p++)i=i.replace("i18nExtendedVariable",f[p]);return i},e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Inject,args:[n]},{type:t.Optional}]}]},e.ngInjectableDef=t.defineInjectable({factory:function(){return new e(t.inject(n,8))},token:e,providedIn:"root"}),e}(),i=function(){function e(e,t){this.el=e,this.i18n=t}return e.prototype.ngOnInit=function(){this.translate()},e.prototype.ngOnChanges=function(){this.translate()},e.prototype.translate=function(){var e=this;setTimeout(function(){e.el.nativeElement.childNodes&&e.el.nativeElement.childNodes[0]&&e.el.nativeElement.childNodes[0].nodeValue&&(e.i18nExtended?e.el.nativeElement.innerText=e.i18n.translateText(e.el.nativeElement.childNodes[0].nodeValue,e.i18nExtended):e.el.nativeElement.innerText=e.i18n.translateText(e.el.nativeElement.childNodes[0].nodeValue))})},e.decorators=[{type:t.Directive,args:[{selector:"[i18nExtended]"}]}],e.ctorParameters=function(){return[{type:t.ElementRef},{type:r}]},e.propDecorators={i18nExtended:[{type:t.Input}]},e}(),a=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{declarations:[i],exports:[i]}]}],e}(),o=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{imports:[a],exports:[a]}]}],e}();e.i18nExtendedModule=o,e.I18N_EXTENDED_DATA=n,e.i18nExtended=r,Object.defineProperty(e,"__esModule",{value:!0})});